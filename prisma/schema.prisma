generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model udm_tbl_users {
  id         String               @id @default(uuid())
  fullname   String?
  password   String
  status     String?
  created_at DateTime             @default(now())
  updated_at DateTime             @updatedAt
  email      String               @unique
  user_roles udm_tbl_user_roles[]
}

model udm_tbl_roles {
  id               String                     @id @default(uuid())
  name             String                     @unique
  description      String?
  created_at       DateTime                   @default(now())
  updated_at       DateTime                   @updatedAt
  role_permissions udm_tbl_role_permissions[]
  user_roles       udm_tbl_user_roles[]
}

model udm_tbl_user_roles {
  id     String        @id
  userId String
  roleId String
  role   udm_tbl_roles @relation(fields: [roleId], references: [id])
  user   udm_tbl_users @relation(fields: [userId], references: [id])

  @@unique([userId, roleId])
}

model udm_tbl_permissions {
  id               String                     @id @default(uuid())
  name             String                     @unique
  description      String?
  created_at       DateTime                   @default(now())
  updated_at       DateTime                   @updatedAt
  role_permissions udm_tbl_role_permissions[]
}

model udm_tbl_role_permissions {
  id           String              @id
  roleId       String
  permissionId String
  permission   udm_tbl_permissions @relation(fields: [permissionId], references: [id])
  role         udm_tbl_roles       @relation(fields: [roleId], references: [id])

  @@unique([roleId, permissionId])
}

model ddm_tbl_driverInfo {
  id            String  @id @default(uuid())
  userId        String  @unique
  fullname      String
  callSign      String?
  address       String?
  contactNumber String?

  carAssignment DriverCarAssignment

  spouseName    String?
  spouseContact String?

  sssNumber        String?
  philhealthNumber String?
  pagibigNumber    String?

  licenseImageUrl String?
  licenseNumber   String?
  licenseExpiry   DateTime?

  status DriverStatus @default(ACTIVE)

  apprehensions ddm_tbl_driverApprehension[]
  ledgers       ddm_tbl_driverLedgers[]
  contributions ddm_tbl_driverContributions[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

model ddm_tbl_driverApprehension {
  id            String   @id @default(uuid())
  driverId      String
  violationType String
  ticketExpiry  DateTime
  isHeld        Boolean  @default(false)

  driver ddm_tbl_driverInfo @relation(fields: [driverId], references: [id])

  created_at DateTime @default(now())
}

model ddm_tbl_driverLedgers {
  id       String     @id @default(uuid())
  driverId String
  type     LedgerType
  amount   Decimal    @db.Decimal(12, 2)
  remarks  String?

  driver ddm_tbl_driverInfo @relation(fields: [driverId], references: [id])

  created_at DateTime @default(now())
}

model ddm_tbl_driverContributions {
  id               String           @id @default(uuid())
  driverId         String
  contributionType ContributionType
  referenceNo      String?
  amount           Decimal          @db.Decimal(12, 2)

  driver ddm_tbl_driverInfo @relation(fields: [driverId], references: [id])

  created_at DateTime @default(now())
}

enum DriverCarAssignment {
  GROUP_A
  GROUP_B
  DAILY
  TRUCK
}

enum DriverStatus {
  ACTIVE
  INACTIVE
  LEGAL
  HOLD_ACTIVE
}

enum LedgerType {
  CREDIT // deposit
  DEBIT // charges
}

enum ContributionType {
  SSS
  PHILHEALTH
  PAGIBIG
}
